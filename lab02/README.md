# Lab 02 Spanning Tree Protocol

### Топология сети
<image src="scheme.png">

Задачи лабораторной работы:  
1. Создание сети и настройка основных параметров устройства  
2. Выбор корневого моста  
3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов  
4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов    

### Исходные данные:  
Свитч Cisco IOS - 3 Pcs  

## Таблица адресов  

|Device|	Interface |	IP Address   |	Subnet  Mask |
|------|--------------|-----------   |--------       |
|S1	   | VLAN 1  |	192.168.1.1 | 255.255.255.0	|
|S2	    |VLAN 1   |	192.168.1.2 |	255.255.255.0 |
|S3	 |VLAN 1 |	192.168.1.3 |	255.255.255.0 |

### Базовая конфигурация на примере свитча S1

Назначить имя устройства: **hostname S1** (для других сетевых устройств аналогично)  
Отключить DNS lookup: **no ip domain-lookup** (для других сетевых устройств аналогично)  
Назначить cisco логином и паролем для настроек: **username cisco privilege 15 password cisco**  
Назначить cisco логином и паролем для терминала: 
**line vty 0 4**  
**login local**  
Назначить cisco логином и паролем для консоли:  
**line con 0**  
**login local**  
Установить корректное время: **clock timezone PST 3 0**  
Шифровать пароли: **service password-encryption**   
Создать предупреждающий баннер:   
**banner motd**  
**For authorized persons only**  
Назначить class паролем на enable: **enable secret class**  
Настроить logging synchronous для консольного канала:
**line con 0**
**logging synch**
**line vty 0 4**
**logging synch**

## Проверить взаимную видимость коммутаторов    


<image src="s1_ping.png">  

<image src="s2_ping.png">  

## Настройка trunk на S1  
int Gi0/0  
switchport trunk encapsulation dot1q  
switchport mode trunk  

int Gi0/1  
switchport trunk encapsulation dot1q  
switchport mode trunk 

int Gi0/2  
switchport trunk encapsulation dot1q  
switchport mode trunk 

int Gi0/3  
switchport trunk encapsulation dot1q  
switchport mode trunk 

На свитчах S2, S3 настрийки аналогичны

## Первоначальные данные протокола Spanning Tree  

S1  
<image src="s1_span1.png">  

S2    
<image src="s2_span1.png">  

S3  
<image src="s3_span1.png">    

Топология сети  
<image src="scheme.png">  

Свитч S1 является корневым мостом.  
Свитч S1 обладает минимальным Bridge ID (в частности минимальным МАС-адресом).  
S1 - все порты Designated  
S2 - Gi0/1 Alternate, Gi0/3 Designated  
S3 - Gi0/1 Root, Gi0/3 Designated  

Изменяем стоимость порта Gi0/3 на свитче S2:
**interface Gi0/3**  
**spanning-tree cost 2**  

Протокол заменяетт ранее заблокировнный порт и блокирует порт на другом свитче, т.к. стоимость, которую транслирует свитч, изменилась (с 4 до 2).  

<image src="s2_cost2.jpg">  

Удаляем назначенную стоимость:  

**interface Gi0/3**  
**no spanning-tree cost 2** 

Включаем на свитчах S1, S2, S3 скоммутированные и выключенные порты командой: **no sh**  

Теперь данные STP выглядят так:  

S2  
<image src="s2_4.jpg">  

S3  
<image src="s3_4.jpg">  

Root порты некорневых свитчей:    
S2 - Gi0/2  
S3 - Gi0/0  

Для S2 порт Gi0/2 был выбран корневым т.к. номер порта Gi0/2 < Gi0/3 (3 < 4). Другие два порта не могут быть корневыми, т.к. стоимость стоимость маршрута S2 -> S3 -> S1 , больше стоимости маршрута S2 -> S1. 

Для S3 порт Gi0/0 был выбран корневым т.к. номер порта Gi0/0 < Gi0/1 (1 < 2). Другие два порта не могут быть корневыми, т.к. стоимость стоимость маршрута S3 -> S2 -> S1 , больше стоимости маршрута S3 -> S1.  

## Контрольные вопросы:  
**Вопрос:** Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?  
**Ответ:** Порт, обладающий наименьшей стоимостью пути к корневому мосту  

**Вопрос:** Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?  
**Ответ:** Самое низкое значение идентификатора моста-отправителя  

**Вопрос:** Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?  
**Ответ:**  Самое низкое значение идентификатора порта-отправителя  


## Полезные ссылки

[Конфигурация свитча S1](./S1.md)  

[Конфигурация свитча S2](./S2.md)

[Конфигурация свитча S3](./S3.md)

[Файл лабораторной работы](./lab01.uml)  














