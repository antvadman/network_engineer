# Lab 11 BGP Управление анонсами

Задачи лабораторной работы:  

1. Настроить фильтрацию в офисе Москва так, чтобы не появилось транзитного трафика(As-path).
2. Настроить фильтрацию в офисе С.-Петербург так, чтобы не появилось транзитного трафика(Prefix-list).
3. Настроить провайдера Киторн так, чтобы в офис Москва отдавался только маршрут по умолчанию.
4. Настроить провайдера Ламас так, чтобы в офис Москва отдавался только маршрут по умолчанию и префикс офиса С.-Петербург.

### 1 Настроить фильтрацию в офисе Москва так, чтобы не появилось транзитного трафика(As-path)
Чтобы трафик не был транзитным, АС должна отдавать только свои префиксы, те оригинированные в ней.
Сл-но, регулярным выражением выбираем последнюю подстроку в строке AS_Path.
На пограничных роутерах R14 и R15 настраиваем:
```
ip as-path access-list 1 permit _1001_$
router bgp 1001
neighbor 11.0.0.1 filter-list 1 out
```
### 2 Настроить фильтрацию в офисе С.-Петербург так, чтобы не появилось транзитного трафика(Prefix-list)
Аналогично п.1, только настраиваем через prefix list на R18. Назначаем prefix-list для соседа на каждом линке.
```
ip prefix-list 1 seq 5 permit 192.168.8.0/24
ip prefix-list 1 seq 10 permit 192.168.9.0/24
router bgp 2042
 neighbor 14.0.4.2 prefix-list 1 out
 neighbor 14.0.5.2 prefix-list 1 out
```
### 3. Настроить провайдера Киторн так, чтобы в офис Москва отдавался только маршрут по умолчанию
На роутере R22 настраиваем:
```
router bgp 101
 bgp log-neighbor-changes
 neighbor 11.0.0.2 default-originate
```
Далее нам нужно отфильтровать другие анонсированне префиксы. Сделаем через префикс-лист на вход:
```
ip prefix-list 1 seq 5 permit 0.0.0.0/0
router bgp 1001
 neighbor 11.0.0.1 prefix-list 1 in
```
Теперь на R14 мы получаем дефолт по bgp:
```
B*    0.0.0.0/0 [20/0] via 11.0.0.1, 00:02:24
```
### 4. Настроить провайдера Ламас так, чтобы в офис Москва отдавался только маршрут по умолчанию и префикс офиса С.-Петербург
На роутере R21 мы отдаем маршрут по умолчанию и префиксы СПБ.
```
ip prefix-list 1 seq 5 permit 192.168.8.0/24
ip prefix-list 1 seq 10 permit 192.168.9.0/24

router bgp 301
 neighbor 12.0.0.2 default-originate
 neighbor 12.0.0.2 prefix-list 1 out
```
Теперь на R15 таблица маршрутизации выглядит так:
```
B*    0.0.0.0/0 [20/0] via 12.0.0.1, 00:05:46 - анонсированный дефолт
      12.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
B        12.12.12.12/32 [200/0] via 101.0.0.2, 00:05:46 - лупбэк локального роутера
      13.0.0.0/32 is subnetted, 1 subnets
B        13.13.13.13 [200/0] via 10.1.1.1, 00:05:46 - лупбэк локального роутера
B     192.168.0.0/24 [200/0] via 101.0.0.2, 00:05:46 - внутренняя сеть
B     192.168.1.0/24 [200/0] via 101.0.0.2, 00:05:46 - внутренняя сеть
B     192.168.8.0/24 [20/0] via 12.0.0.1, 00:05:46 - пропущенная сеть
B     192.168.9.0/24 [20/0] via 12.0.0.1, 00:05:46 - пропущенная сеть
```














